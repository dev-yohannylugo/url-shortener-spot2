name: Deploy Laravel App to AWS

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
   deploy:
      if: github.ref == 'refs/heads/master'
      runs-on: [ubuntu-latest]
      steps:
        - uses: actions/checkout@v1
        - name: Push to server
          uses: appleboy/ssh-action@master
          with:
            host: http://ec2-18-221-204-190.us-east-2.compute.amazonaws.com/
            username: ubuntu
            port: 22
            key: ${{ secrets.SSH_PRIVATE_KEY }}
            script: |
              cd /var/www/url-shortener-spot2
              git pull
              npm install
              composer install
              npm run build
              php artisan migrate --seed
              sudo systemctl restart nginx
